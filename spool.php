<?php
require "vendor/autoload.php";
require "env.php";

$spool_sludge = '[{"ID":"recHDyntkv19vb8yN","Name":"Teng Li","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMU"},{"ID":"recqj8Z3FqjuxHOYY","Name":"Marcus Blake","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMV"},{"ID":"recCHXbqylDXPPHHs","Name":"Mairi  Quinn","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMW"},{"ID":"recc6mCBZqWhN66Mz","Name":"Peter  Fenwick","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMX"},{"ID":"rec6eSqzbgOxm2GsB","Name":"Ben  Jorgensen","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMY"},{"ID":"rech18E5icIqiuWR8","Name":"JIM  HART","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMZ"},{"ID":"recmHeiKDHhJW6huD","Name":"JUSTIN  MILLER","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN0"},{"ID":"rec1c79LXwhQlO0b8","Name":"KIERAN  KHANNA","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2mcQwb"},{"ID":"receyGGREN05Ad3jV","Name":"Rudy  Grommen","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN3"},{"ID":"recNqzmmN0sAxz4v1","Name":"Tony  Ghanem","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN4"},{"ID":"rec1CRfxM3HniGZqW","Name":"Azhar  Omar","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN5"},{"ID":"rec27TtPe8vXltrs7","Name":"John  Ahern","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN6"},{"ID":"rec5xOLTebA0le08U","Name":"Jamie  Streten","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN7"},{"ID":"recYkd6vZknHFfjIA","Name":"David  Bruce","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2mcRwk"},{"ID":"recC8hPGC7tnPzImT","Name":"CARLOS  HALIM","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN7"},{"ID":"recQ2QLRiGR7hu7F0","Name":"JAMIE  DOUGLAS","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN9"},{"ID":"rec9cTHZgezufK0G0","Name":"Andrew  Carter","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNa"},{"ID":"recXezFYvvBh6uldC","Name":"Benita  McMahon","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNb"},{"ID":"recvlEsqaK6GeMU7G","Name":"Ross Cattle","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNc"},{"ID":"recHKnPYyw9GESLX1","Name":"Gail & Ian Gobey","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNd"},{"ID":"recMACuO90XtDESEl","Name":"Michael  Young","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNe"},{"ID":"recCsephoO5a4xFXV","Name":"Tony  Fernandez","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNf"},{"ID":"recPgl1k6sq5ehkkk","Name":"Victoria  Nicholson","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZN5"},{"ID":"recx2gaE0I9kSsqjD","Name":"Phil  Grant","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNg"},{"ID":"recKRWBNDdtx1r3pA","Name":"Sirah  Robb","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNh"},{"ID":"recZoZoa7v8imdcZW","Name":"Nick  Buick","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNi"},{"ID":"recvbvcVldjKz3XJQ","Name":"Toni  Kuchtin","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNj"},{"ID":"recyMgaXrQDa7NUWX","Name":"Maria Lee","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNk"},{"ID":"recxP3zjchq2I9Nmb","Name":"Karl  Melcheck","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNl"},{"ID":"receRUvbK8nNB1v9m","Name":"Solomon  Soner","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZNn"},{"ID":"recfxg2gyjjHdb8t6","Name":"Adam  Scott","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpv"},{"ID":"recCqqw4wnDQrVxeC","Name":"Nick  Kruger","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpw"},{"ID":"recLwOQqST0Y6vksD","Name":"Shirley  Rowles","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpx"},{"ID":"recqr1kcqYRjbqleW","Name":"Vaughan  Keenan","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpy"},{"ID":"recP6mhzOYXivMjgH","Name":"Brett  Gillespie","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpz"},{"ID":"recnf0cYECmP4pBUd","Name":"Stuart Moody","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUWpA"},{"ID":"rec3KdsxX21g7Ahd8","Name":"Marie Moore","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtT"},{"ID":"rec8PLqDFobkKG6JW","Name":"Lara Faliu","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtU"},{"ID":"receFAaQhesBifqDC","Name":"Angie Wallwork","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtV"},{"ID":"reciPiRnI26zqiahd","Name":"John Gribbin","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMW"},{"ID":"rec0biCYUrETWkOzc","Name":"Patrick Woods","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lTZMY"},{"ID":"recCww3Qdlp2OIysi","Name":"Todd Hayley","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtW"},{"ID":"rec78Aa5qhcmMofE7","Name":"Giovanni Spinella","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtX"},{"ID":"recCOirpr3oQ7Wcce","Name":"Maxine Pemble","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtY"},{"ID":"recSfir3HcdUEpsGp","Name":"Brad  Franks","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZtZ"},{"ID":"recm9r3wChxGKLonQ","Name":"Robyn  Pluis","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZu0"},{"ID":"recmK38NfeUgoxuJE","Name":"Melissa  Morgan","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lUZu1"},{"ID":"recW8Del9vgmSwvtj","Name":"George  Savva","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05c"},{"ID":"rec69N1WoIfzlUXJ1","Name":"Courtney  Rumble","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05d"},{"ID":"recYvSlAnAhCxz76y","Name":"Paul  Black","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05e"},{"ID":"recQkEDmZWdJwq26a","Name":"Tennille  Mugridge","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05f"},{"ID":"recMfHQe9pvN9wUfc","Name":"Shaun  Hudson-Smith","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05g"},{"ID":"recZcTBdD9lYaKbhS","Name":"James  Harvey","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05h"},{"ID":"recTo6iEHkNdPAfKH","Name":"daniel  gavan","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05i"},{"ID":"rec9qtv4uWW3IR5cR","Name":"Tammy Stringer","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08g"},{"ID":"recI92do8jMToycJh","Name":"Glen   Archer","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08h"},{"ID":"recZAbVBcNYk4gV19","Name":"Glenn  Ball","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08i"},{"ID":"reckVrfVdBiuQrMv2","Name":"Justin  Watt","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08j"},{"ID":"rec8y2D0Lastfj5b9","Name":"Sally  Wrigley","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08k"},{"ID":"recXPevDoQb3OA89b","Name":"Johnny  Zakarian","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV08m"},{"ID":"recrd16tBZnvgbhj5","Name":"Daniel  Makovec","URL":"https://headstudios.com.au/for_you/sales-terminator-army-generator/","LinkID":"lnk_1LHi_2lV05i"}]';
    $spool_sludge = json_decode($spool_sludge, true);

echo '<pre>';
//var_dump($spool_sludge);
echo '</pre>';

$client = new GuzzleHttp\Client();

$requestGenerator = function($spool_sludge) use ($client) {
	foreach($spool_sludge as $spool) {
		// The magic happens here, with yield key => value
		yield $spool => function() use ($client, $spool) {
			// Our identifier does not have to be included in the request URI or headers
            
            echo "Spool Link ID is: ".$spool['LinkID'];
            $link_id = $spool['LinkID'];
            $title = 'New Pool';
            $image = 
            $description = 'Jump in the Pool';
            //$shortnweird = '[["title","'.$title.'"],["description", "'.$description.'"]';
            $data = '[["title","Coming Home"]]';
            $url = 'https://api.short.io/links/opengraph/421680/'.$link_id;
			return $client->putAsync($url, [
                'body' => $data,
                'headers' => [
                  'Accept' => 'application/json',
                  'Authorization' => 'sk_dr6h17exR4jZwOM7',
                  'Content-Type' => 'application/json',
                ]]);
		};
	}
};



$pool = new GuzzleHttp\Pool($client, $requestGenerator($spool_sludge), [
	'concurrency' => 3,
	'fulfilled' => function(GuzzleHttp\Psr7\Response $response, $index) {
		// This callback is delivered each successful response
		// $index will be our special identifier we set when generating the request
		$json = json_decode((string)$response->getBody());

        echo $json;

		// If these values don't match, something is very wrong
        //echo "Index is: ";
        //var_dump($index);
		//echo "Requested search term: ", $index, "\n";
		//echo "Parsed from response: ", $json->headers->{'X-Search-Term'}, "\n\n";
	},
	'rejected' => function(Exception $reason, $index) {
		// This callback is delivered each failed request
		//echo "Requested search term: ", $index, "\n";
		echo $reason->getMessage(), "\n\n";
	},
]);

// Initiate the transfers and create a promise
$promise = $pool->promise();
// Force the pool of requests to complete
$promise->wait();

die();




die();



function OGLinkStatus($link_id, $title, $description, $image) {
    $log = "Inside OGLinkStatus function - link id is: ".$link_id;
    //$this->console_log($log);
    global $shortio_secret;
    $domainid = '421680';
    

    $client = new GuzzleHttp\Client();

    $short_data = [
        "title" => $title,
        "description" => $description,
        "image" => $image,
        "image:type" => 'image/jpg'
    ];
    //$shortnweird = '[["title","Is there anybody out there"],["description","'.$description.'"]]';
    $shortnweird = '[["title","'.$title.'"],["description", "'.$description.'"],["image","'.$image.'"],["image:type","image/jpg"]]';

    /*$response = $client->request('PUT', $post_url, [
        'body' => $shortnweird,
        'headers' => [
          'Accept' => 'application/json',
          'Authorization' => 'sk_dr6h17exR4jZwOM7',
          'Content-Type' => 'application/json',
        ],
      ]);*/ 


      $post_url = 'https://api.short.io/links/opengraph/'.$domainid.'/'.$link_id;
      $response = $client->request('PUT', $post_url, [
        'body' => $shortnweird,
        'headers' => [
          'Accept' => 'application/json',
          'Authorization' => 'sk_dr6h17exR4jZwOM7',
          'Content-Type' => 'application/json',
        ],
      ]);

      
      
      


    //var_dump(json_decode($response->getBody(),true));    
    
}
